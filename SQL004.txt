CREATE DATABASE test;

use test;

create table orders_data
(
cust_id int,
order_id int,
country varchar(50),
state varchar(50)
);

insert into orders_data values(1, 100, 'USA', 'Seattle');
insert into orders_data values(2, 101, 'INDIA', 'UP');
insert into orders_data values(2, 103, 'INDIA', 'Bihar');
insert into orders_data values(4, 108, 'USA', 'WDC');
insert into orders_data values(5, 109, 'UK', 'London');
insert into orders_data values(4, 110, 'USA', 'WDC');
insert into orders_data values(3, 120, 'INDIA', 'AP');
insert into orders_data values(2, 121, 'INDIA', 'Goa');
insert into orders_data values(1, 131, 'USA', 'Seattle');
insert into orders_data values(6, 142, 'USA', 'Seattle');
insert into orders_data values(7, 150, 'USA', 'Seattle');

SELECT * from orders_data;

--- Use of Having clause
--- write a query to find the country where only 1 order was placed
select country from orders_data group by country Having count(*)=1;

--- Where clause and group by clause -> what should be the proper sequence?
--- Answer -> where clause and then group BY

--- How to use GROUP_CONCAT
--- Query -> Write a query to print DISTINCT states present in the dataset for each country

SELECT country, GROUP_CONCAT(state) as states_in_country from orders_data group by country;
SELECT country, GROUP_CONCAT(distinct state) as states_in_country from orders_data group by country;

SELECT country, GROUP_CONCAT(distinct state order by state desc) as states_in_country from orders_data group by country;

SELECT country, GROUP_CONCAT(distinct state order by state desc SEPARATOR '_') as states_in_country from orders_data group by country;

SELECT country, GROUP_CONCAT(distinct state order by state desc SEPARATOR '  -  ') as states_in_country from orders_data group by country;

--- subqueries 
CREATE table employees
(
    id int,
    name VARCHAR(50), 
    salary int
);

insert into employees values(1, 'mujahid', 5000), (2, 'raza', 5500), (3, 'ayyub', 6000), (4, 'danish', 7000), (5, 'ali', 6500), (6, 'zesu', 7500);

select * from employees;

--- Write a query to print all those employee records who are getting more salary then "ali"
--- wrong way -> select salary from employees where salary > 6500;

select * from employees where salary > (select salary from employees where name= 'ali');


--- Use of IN and NOT IN
--- Write a query to print all the orders which were placed in 'seattle' or 'Goa'

--- wrong way ->  select * from orders_data where state = 'Seattle' or state 'Goa';

select * from orders_data where state in ('Seattle', 'Goa'); 

CREATE table customer_order_data
(
    order_id int,
    cust_id int,
    supplier_id int,
    cust_country VARCHAR(50)
);

insert into customer_order_data values(101,200,300,'USA'),(102,201,301,'INDIA'),(103,202,302,'USA'),(104,203,303,'UK');

CREATE TABLE supplier_data
(
    supplier_id int,
    sup_country VARCHAR(50)
);

insert into supplier_data values(300,'USA'),(303,'UK');

--- Write a query to find all customer order data where all customers are from same countries as tha supplier 
select * from customer_order_data where cust_country in (select distinct sup_country from supplier_data);



CREATE table student_marks
(
    stu_id int,
    stu_name VARCHAR(50),
    total_marks int
);

insert into student_marks values(1, 'mujahid', 50);
insert into student_marks values(2, 'raza', 91);
insert into student_marks values(3, 'ayyub', 74);
insert into student_marks values(4, 'aamir', 65);
insert into student_marks values(5, 'ali', 86);
insert into student_marks values(6, 'danish', 77);

--- Write a query to calculate the grade for a  student by following below criteria
# marks >= 90, grade A+
# marks < 90 and marks >= 85, grade A
# marks < 85 and marks >= 75, grade B+
# marks < 75 and marks >= 60, grade B
# marks < 60 grade C

select stu_id,
       stu_name,
       total_marks,
       CASE 
        WHEN total_marks >= 90 THEN 'A+'
        WHEN total_marks >= 85 and total_marks < 90 THEN 'A'
        WHEN total_marks >= 75 and total_marks < 85 THEN 'B+'
        WHEN total_marks >= 60 and total_marks < 75 THEN 'B'
        ELSE  'C'
       END as Grade
from student_marks;       
